---
  - name: ensure old versions of Docker are not present
    yum:
      name: "{{ item }}"
      state: absent
    with_items:
      - docker
      - docker-common
      - docker-engine

  - name: install required packages
    yum:
      name: "{{ item }}"
    with_items:
      - yum-utils
      - device-mapper-persistent-data
      - lvm2

  - name: add Docker repository
    get_url:
      url: https://download.docker.com/linux/centos/docker-ce.repo
      dest: /etc/yum.repos.d/docker-ce.repo
      owner: root
      group: root
      mode: 0644

  - name: install Docker CE
    yum:
      name: "{{ docker_ce_pkg_name }}-{{ centos_docker_ce_version }}"

  - name: install yum-versionlock
    yum:
      name: yum-versionlock

  - name: pin Docker CE version
    command: yum versionlock add {{ docker_ce_pkg_name }}
